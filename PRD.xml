<?xml version="1.0" encoding="utf-8"?>
<!--
  Product Requirements Document (PRD)
  For: Leveraged Grid + DCA Hybrid Trading Bot
  Broker: Bybit (supports demo and live)
  Implementation: Python, CLI-based, configured via .env
-->
<PRD version="1.0">
  <Metadata>
    <ProductName>LeveragedGridDCA_Hybrid_Bybit</ProductName>
    <Author>Generated by Assistant</Author>
    <Created>2025-09-16</Created>
    <Stakeholders>
      <Stakeholder>Solo Trader / Operator</Stakeholder>
      <Stakeholder>Developer / Maintainer</Stakeholder>
      <Stakeholder>Risk Manager (self)</Stakeholder>
    </Stakeholders>
  </Metadata>

  <ProblemStatement>
    Manual leveraged grid and DCA trading is time-consuming and error-prone. A fully autonomous Python bot with logging and configurable parameters is needed.
  </ProblemStatement>

  <Objectives>
    <Objective>Run and manage the bot via Python CLI with all configuration in .env.</Objective>
    <Objective>Automate leveraged grid + DCA trading for demo and live Bybit accounts.</Objective>
    <Objective>Provide detailed logging for tracking trades, fills, PnL, and risk events.</Objective>
    <Objective>Ensure robust risk management including kill-switches and breakeven stops.</Objective>
  </Objectives>

  <Scope>
    <InScope>
      <Item>Python-based bot using Bybit API (demo/live).</Item>
      <Item>Configuration entirely via .env (API keys, capital, grids, leverage, DCA parameters).</Item>
      <Item>Logging of all trade actions and risk events.</Item>
      <Item>Backtesting using historical Bybit data integrated with bot.</Item>
      <Item>Automated risk management (kill-switch, breakeven, partial profits).</Item>
    </InScope>
    <OutOfScope>
      <Item>Web interface or dashboard.</Item>
      <Item>Third-party broker integrations.</Item>
      <Item>Portfolio management across multiple bots.</Item>
    </OutOfScope>
  </Scope>

  <UserStories>
    <UserStory id="U1">
      <As>Solo trader</As>
      <IWant>to configure the bot entirely via .env</IWant>
      <SoThat>I can run, pause, or adjust it without additional tools.</SoThat>
    </UserStory>
    <UserStory id="U2">
      <As>Solo trader</As>
      <IWant>logs of every trade, fill, and PnL event</IWant>
      <SoThat>I can review performance anytime.</SoStory>
    </UserStory>
    <UserStory id="U3">
      <As>Solo trader</As>
      <IWant>alerts for critical events (kill-switch, margin, or errors)</IWant>
      <SoThat>I can intervene promptly if needed.</SoStory>
    </UserStory>
  </UserStories>

  <FunctionalRequirements>
    <Requirement id="FR1">Connect securely to Bybit API (demo or live) using .env configuration.</Requirement>
    <Requirement id="FR2">Grid engine with configurable range, spacing, and order size from .env.</Requirement>
    <Requirement id="FR3">DCA engine for trend continuation with parameters from .env.</Requirement>
    <Requirement id="FR4">Logging of all orders, fills, account state changes, and risk events.</Requirement>
    <Requirement id="FR5">Python CLI interface for start, stop, status, and emergency shutdown.</Requirement>
    <Requirement id="FR6">Automated risk management (kill-switch, breakeven stops, partial profits).</Requirement>
    <Requirement id="FR7">Backtesting engine integrated with historical Bybit data.</Requirement>
  </FunctionalRequirements>

  <NonFunctionalRequirements>
    <Requirement id="NFR1">Handle up to 50 concurrent open orders.</Requirement>
    <Requirement id="NFR2">Low latency to Bybit API (<300ms).</Requirement>
    <Requirement id="NFR3">Bot uptime target 99% with auto-recovery.</Requirement>
    <Requirement id="NFR4">State persistence via SQLite or Postgres to survive restarts.</Requirement>
    <Requirement id="NFR5">Logs rotated and retained for 30+ days.</Requirement>
  </NonFunctionalRequirements>

  <KPIs>
    <KPI>Monthly return target: 5-10% (demo and live)</KPI>
    <KPI>Max drawdown: <=20%</KPI>
    <KPI>Profit factor: >1.5 on backtests</KPI>
    <KPI>Win rate: >55% of closed trades</KPI>
  </KPIs>

  <Assumptions>
    <Assumption>User has funded Bybit demo and live accounts.</Assumption>
    <Assumption>User can provide API keys securely via .env.</Assumption>
    <Assumption>Market volatility is within historical norms.</Assumption>
  </Assumptions>

  <Risks>
    <Risk>High leverage increases liquidation risk if kill-switch fails.</Risk>
    <Risk>API downtime or rate limits could delay orders.</Risk>
    <Risk>Poorly configured grids may trap capital.</Risk>
    <Risk>User may go live before sufficient demo testing.</Risk>
  </Risks>

  <Milestones>
    <Milestone id="M1">Python bot architecture and Bybit API integration (2 weeks)</Milestone>
    <Milestone id="M2">Grid engine implementation (2 weeks)</Milestone>
    <Milestone id="M3">DCA engine implementation (1 week)</Milestone>
    <Milestone id="M4">Backtesting framework (2 weeks)</Milestone>
    <Milestone id="M5">Risk management & alerts (2 weeks)</Milestone>
    <Milestone id="M6">Demo mode testing and tuning (3 weeks)</Milestone>
    <Milestone id="M7">Live rollout with staged capital (ongoing)</Milestone>
  </Milestones>

  <AcceptanceCriteria>
    <Criterion>Bot runs in demo mode with full logging for 4+ weeks.</Criterion>
    <Criterion>Backtest results meet KPIs.</Criterion>
    <Criterion>Kill-switch triggers correctly under stress tests.</Criterion>
    <Criterion>Switching demo to live requires only .env parameter change.</Criterion>
  </AcceptanceCriteria>

  <Appendices>
    <Appendix id="A1">Glossary: Grid, DCA, Kill-switch, Breakeven, PnL</Appendix>
    <Appendix id="A2">Reference: Bybit API documentation</Appendix>
    <Appendix id="A3">Reference: Risk management ruleset</Appendix>
  </Appendices>
</PRD>
